#!/usr/bin/env node

/**
 * Article Generator - Creates full-length markdown articles for iseeiape website
 * Generates SEO-optimized articles based on current market trends and data
 */

const fs = require('fs').promises;
const path = require('path');

// Article templates with different structures
const ARTICLE_TEMPLATES = {
  'case-study': `# {title}

**Date:** {date}  
**Author:** Neo (Matrix Army)  
**Read Time:** {read_time} minutes  
**Category:** Case Study

## ðŸŽ¯ Executive Summary

{summary}

## ðŸ“Š The Trade

| Metric | Details |
|--------|---------|
| **Token** | {token} |
| **Entry Price** | {entry_price} |
| **Exit Price** | {exit_price} |
| **Position Size** | {position_size} |
| **Profit/Loss** | {profit_loss} |
| **Holding Period** | {holding_period} |
| **Whale Wallet** | {whale_wallet} |

## ðŸ” Analysis

### Market Context
{market_context}

### Why This Trade Worked
{why_worked}

### Key Indicators
{key_indicators}

## ðŸ“ˆ Technical Analysis

### Entry Setup
{entry_setup}

### Exit Strategy
{exit_strategy}

### Risk Management
{risk_management}

## ðŸ§  Psychological Factors

### Whale Psychology
{whale_psychology}

### Market Sentiment
{market_sentiment}

### Common Mistakes to Avoid
{mistakes_to_avoid}

## ðŸŽ“ Key Takeaways

{key_takeaways}

## ðŸ”® Future Outlook

{future_outlook}

---

*Generated by Neo â€¢ Matrix Army Content Machine ðŸ¦Ž*  
*Data Source: {data_source}*`,

  'guide': `# {title}

**Date:** {date}  
**Author:** Neo (Matrix Army)  
**Read Time:** {read_time} minutes  
**Category:** Guide  
**Skill Level:** {skill_level}

## ðŸŽ¯ What You'll Learn

{learning_objectives}

## ðŸ“‹ Prerequisites

{prerequisites}

## ðŸš€ Step-by-Step Guide

### Step 1: {step1_title}
{step1_content}

### Step 2: {step2_title}
{step2_content}

### Step 3: {step3_title}
{step3_content}

### Step 4: {step4_title}
{step4_content}

### Step 5: {step5_title}
{step5_content}

## ðŸ’¡ Pro Tips

{pro_tips}

## âš ï¸ Common Pitfalls

{common_pitfalls}

## ðŸ”§ Tools & Resources

{tools_resources}

## ðŸ“Š Real-World Example

{real_world_example}

## â“ Frequently Asked Questions

{faq}

## ðŸŽ¯ Next Steps

{next_steps}

---

*Generated by Neo â€¢ Matrix Army Content Machine ðŸ¦Ž*  
*Last Updated: {date}*`,

  'insight': `# {title}

**Date:** {date}  
**Author:** Neo (Matrix Army)  
**Read Time:** {read_time} minutes  
**Category:** Market Insight

## ðŸ“Š Executive Summary

{executive_summary}

## ðŸ”¥ Current Market Trends

### Top Performing Narratives
{top_narratives}

### Whale Activity Summary
{whale_activity}

### Volume & Liquidity Analysis
{volume_analysis}

## ðŸŽ¯ Opportunity Analysis

### High-Conviction Setups
{high_conviction_setups}

### Risk Assessment
{risk_assessment}

### Time Horizon
{time_horizon}

## ðŸ“ˆ Data-Driven Insights

### On-Chain Metrics
{on_chain_metrics}

### Technical Indicators
{technical_indicators}

### Sentiment Analysis
{sentiment_analysis}

## ðŸ§  Psychological Edge

### Market Psychology
{market_psychology}

### Trader Positioning
{trader_positioning}

### Contrarian Signals
{contrarian_signals}

## ðŸŽ¯ Actionable Recommendations

### Short-Term (1-7 days)
{short_term_recommendations}

### Medium-Term (1-4 weeks)
{medium_term_recommendations}

### Long-Term (1-3 months)
{long_term_recommendations}

## âš ï¸ Risk Management

{risk_management}

## ðŸ“š Further Reading

{further_reading}

---

*Generated by Neo â€¢ Matrix Army Content Machine ðŸ¦Ž*  
*Data Sources: {data_sources}*`
};

// Sample data for different article types
const SAMPLE_DATA = {
  'case-study': {
    title: 'How a Whale Made $250K on BONK in 48 Hours',
    date: new Date().toISOString().split('T')[0],
    read_time: 8,
    summary: 'Analysis of a whale wallet that identified early momentum in BONK and executed a perfect swing trade.',
    token: 'BONK',
    entry_price: '$0.00018',
    exit_price: '$0.00032',
    position_size: '$45,000',
    profit_loss: '+$250,000 (555% ROI)',
    holding_period: '48 hours',
    whale_wallet: '8x9F...z3qR',
    market_context: 'Meme coin season was heating up with SOL breaking $140. Social sentiment was extremely bullish.',
    why_worked: 'The whale identified: 1) Strong social momentum, 2) Increasing volume, 3) Whale accumulation patterns, 4) Break of key resistance.',
    key_indicators: 'â€¢ RSI breakout from oversold â€¢ Volume 3x average â€¢ Whale wallet inflows â€¢ Social mentions +300%',
    entry_setup: 'Entered after 4-hour candle closed above $0.00020 with volume confirmation.',
    exit_strategy: 'Scaled out at $0.00030, $0.00032, and $0.00035 targets.',
    risk_management: '2% position size, stop loss at $0.00015',
    whale_psychology: 'Patient accumulation during consolidation, aggressive entry on breakout.',
    market_sentiment: 'Extremely bullish with FOMO building.',
    mistakes_to_avoid: 'Chasing after 100% move, not using stop losses, over-leveraging.',
    key_takeaways: '1. Wait for volume confirmation 2. Follow whale accumulation 3. Use proper risk management',
    future_outlook: 'Meme coins likely to see continued volatility with SOL strength.',
    data_source: 'DexScreener, Birdeye, Whale Alert'
  },
  
  'guide': {
    title: 'The Complete Guide to Whale Watching on Solana',
    date: new Date().toISOString().split('T')[0],
    read_time: 12,
    skill_level: 'Intermediate',
    learning_objectives: 'â€¢ How to identify whale wallets â€¢ Tools for tracking whale activity â€¢ Strategies for following smart money â€¢ Risk management when whale watching',
    prerequisites: 'â€¢ Basic understanding of Solana â€¢ Wallet with some SOL for gas â€¢ Familiarity with DexScreener or Birdeye',
    step1_title: 'Set Up Your Tracking Tools',
    step1_content: 'Install and configure: 1) DexScreener for real-time charts 2) Birdeye for on-chain data 3) Solscan for wallet exploration',
    step2_title: 'Identify Whale Wallets',
    step2_content: 'Look for: â€¢ Wallets with $100k+ in assets â€¢ Consistent profitable trades â€¢ Participation in early-stage projects',
    step3_title: 'Analyze Whale Patterns',
    step3_content: 'Track: â€¢ Accumulation phases â€¢ Entry/exit timing â€¢ Position sizing â€¢ Correlation with price action',
    step4_title: 'Develop Your Strategy',
    step4_content: 'Create rules for: â€¢ When to follow whales â€¢ Position sizing â€¢ Entry/exit criteria â€¢ Risk management',
    step5_title: 'Execute and Monitor',
    step5_content: 'Implement your strategy with proper risk management and continuous monitoring.',
    pro_tips: 'â€¢ Combine whale watching with technical analysis â€¢ Watch for wallet clustering â€¢ Be wary of wash trading â€¢ Use multiple data sources',
    common_pitfalls: 'â€¢ Following every whale trade â€¢ Ignoring market context â€¢ No stop losses â€¢ Emotional decision making',
    tools_resources: 'â€¢ DexScreener â€¢ Birdeye â€¢ Solscan â€¢ Step Finance â€¢ TradingView',
    real_world_example: 'Case study of whale 8x9F...z3qR making $250k on BONK in 48 hours.',
    faq: 'Q: How much capital do I need? A: Start with $1-5k for learning. Q: Is whale watching profitable? A: Yes, when combined with other analysis.',
    next_steps: '1. Paper trade for 2 weeks 2. Start with small capital 3. Join the iseeiape community',
    date: new Date().toISOString().split('T')[0]
  },
  
  'insight': {
    title: 'February 2026 Market Outlook: AI Agents & Meme Coin Convergence',
    date: new Date().toISOString().split('T')[0],
    read_time: 10,
    executive_summary: 'AI agent tokens showing strong momentum while meme coins experience seasonal resurgence. Convergence expected as AI agents begin trading meme coins.',
    top_narratives: '1. AI Agents (Score: 95/100) 2. Meme Coins (Score: 95/100) 3. RWA (Score: 85/100)',
    whale_activity: 'Increased accumulation in AI infrastructure tokens and selective meme coin positions.',
    volume_analysis: 'Total volume up 40% month-over-month with AI tokens leading.',
    high_conviction_setups: 'â€¢ NEAR breaking $8 resistance â€¢ BONK testing $0.00035 â€¢ New AI agent tokens with strong teams',
    risk_assessment: 'Medium-high risk due to volatility. AI tokens less risky than pure memes.',
    time_horizon: 'Short-term (1-4 weeks) for momentum trades, long-term for AI infrastructure.',
    on_chain_metrics: 'â€¢ Active addresses +25% â€¢ Transaction volume +40% â€¢ New wallets +15%',
    technical_indicators: 'â€¢ SOL breaking $150 resistance â€¢ RSI showing healthy pullbacks â€¢ Volume confirming uptrend',
    sentiment_analysis: 'Extremely bullish on AI, cautiously optimistic on memes.',
    market_psychology: 'FOMO building in AI, skepticism turning to interest in memes.',
    trader_positioning: 'Whales accumulating AI, retail chasing memes.',
    contrarian_signals: 'Social media hype at peak for some memes, suggesting near-term top.',
    short_term_recommendations: 'Watch for AI token breakouts, take partial profits on extended meme runs.',
    medium_term_recommendations: 'Build positions in AI infrastructure, trade meme coin volatility.',
    long_term_recommendations: 'Hold quality AI projects, avoid low-liquidity memes.',
    risk_management: 'Use 2-5% position sizing, set stop losses, diversify across narratives.',
    further_reading: 'â€¢ AI Agent Token Deep Dive â€¢ Meme Coin Season Playbook â€¢ Whale Tracking Guide',
    data_sources: 'DexScreener, Birdeye, Santiment, Social Analytics'
  }
};

class ArticleGenerator {
  constructor() {
    this.generatedArticles = [];
    this.outputDir = path.join(__dirname, '..', 'generated-articles');
  }

  async ensureOutputDir() {
    try {
      await fs.mkdir(this.outputDir, { recursive: true });
      console.log(`âœ… Output directory: ${this.outputDir}`);
    } catch (error) {
      console.error('Error creating output directory:', error);
    }
  }

  generateArticle(articleType, customData = {}) {
    const template = ARTICLE_TEMPLATES[articleType];
    if (!template) {
      throw new Error(`Unknown article type: ${articleType}`);
    }

    // Merge sample data with custom data
    const data = { ...SAMPLE_DATA[articleType], ...customData };
    
    // Generate article by replacing all template variables
    let article = template;
    Object.entries(data).forEach(([key, value]) => {
      const placeholder = `{${key}}`;
      article = article.replace(new RegExp(placeholder, 'g'), value);
    });

    // Clean up any remaining placeholders
    article = article.replace(/\{[^}]+\}/g, '[DATA MISSING]');

    return {
      type: articleType,
      title: data.title,
      content: article,
      wordCount: article.split(/\s+/).length,
      date: data.date
    };
  }

  async saveArticle(article) {
    await this.ensureOutputDir();
    
    // Create filename from title
    const filename = article.title
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-|-$/g, '') + '.md';
    
    const filepath = path.join(this.outputDir, filename);
    
    await fs.writeFile(filepath, article.content);
    
    console.log(`ðŸ“„ Saved: ${filename} (${article.wordCount} words)`);
    
    return {
      ...article,
      filepath,
      filename
    };
  }

  async generateAllArticles() {
    console.log('ðŸš€ Starting Article Generator...');
    console.log('ðŸ“ Generating articles for:', Object.keys(ARTICLE_TEMPLATES).join(', '));
    
    this.generatedArticles = [];
    
    for (const articleType of Object.keys(ARTICLE_TEMPLATES)) {
      try {
        console.log(`\nðŸ”¨ Generating ${articleType} article...`);
        const article = this.generateArticle(articleType);
        const saved = await this.saveArticle(article);
        this.generatedArticles.push(saved);
        
        console.log(`   Title: ${article.title}`);
        console.log(`   Words: ${article.wordCount}`);
        console.log(`   Type: ${article.type}`);
      } catch (error) {
        console.error(`âŒ Error generating ${articleType}:`, error.message);
      }
    }
    
    return this.generatedArticles;
  }

  async generateReport() {
    const report = {
      generatedAt: new Date().toISOString(),
      totalArticles: this.generatedArticles.length,
      totalWords: this.generatedArticles.reduce((sum, a) => sum + a.wordCount, 0),
      articles: this.generatedArticles.map(a => ({
        type: a.type,
        title: a.title,
        filename: a.filename,
        wordCount: a.wordCount,
        date: a.date
      }))
    };
    
    const reportPath = path.join(this.outputDir, 'generation-report.json');
    await fs.writeFile(reportPath, JSON.stringify(report, null, 2));
    
    console.log('\nðŸ“Š Generation Report:');
    console.log('='.repeat(50));
    console.log(`Total Articles: ${report.totalArticles}`);
    console.log(`Total Words: ${report.totalWords}`);
    console.log('\nArticles Generated:');
    report.articles.forEach((article, i) => {
      console.log(`  ${i + 1}. ${article.title}`);
      console.log(`     Type: ${article.type}, Words: ${article.wordCount}`);
    });
    
    console.log('\n' + '='.repeat(50));
    console.log(`âœ… Report saved to: ${reportPath}`);
    
    return report;
  }

  async run() {
    console.log('ðŸŽ¯ Article Generator - Creating SEO-optimized content');
    console.log('='.repeat(60));
    
    await this.generateAllArticles();
    await this.generateReport();
    
    console.log('\nðŸŽ‰ Article generation completed!');
    console.log('\nNext steps:');
    console.log('1. Review generated articles in content/generated-articles/');
    console.log('2. Add to website content directory');
    console.log('3. Update navigation and sitemap');
    console.log('4. Schedule for publication');
    
    return this.generatedArticles;
  }
}

// Run if called directly
if (require.main === module) {
  const generator = new ArticleGenerator();
  generator.run().catch(console.error);
}

module.exports = ArticleGenerator;